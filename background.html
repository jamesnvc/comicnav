<html>
  <head>
    <script src="jquery.js" type="text/javascript"></script>
    <script>
    function init() {
      var canvas = document.getElementById('canvas');
      var ctx = canvas.getContext('2d');
      
      ctx.fillStyle = "rgb(200,0,0)";
      ctx.fillRect(0,0, 19, 19);
      ctx.clearRect(5, 5, 10, 10)
      
      ctx.fillStyle
      ctx.beginPath();
      ctx.moveTo(10, 19)
      ctx.arc(10,10,10, -Math.PI/2, Math.PI/2, false);
      ctx.closePath();
      ctx.stroke();
      
      chrome.browserAction.setIcon({ "imageData": ctx.getImageData(0,0, canvas.width, canvas.height)});
    }

    chrome.extension.onRequest.addListener(
      function(request, sender, sendResponse) {
        if (request.name == "getPageXPath") {
          var json_str;
          var to_send = { "name": "gotPageXPath" };
          try {
            json_str = localStorage.getItem(request.hostname);
          } catch (e) {
            chrome.tabs.getSelected(null, function(tab) {
              chrome.tabs.sendRequest(tab.id, to_send);
            });
            return;
          }
          to_send.xpath = $.parseJSON(json_str);
          chrome.tabs.getSelected(null, function(tab) {
            chrome.tabs.sendRequest(tab.id, to_send);
          });
          sendResponse(to_send)
          return;
        } else {
          sendResponse({});
        }
      });
    </script>
  </head>
  <body onload="init()">
    <canvas id="canvas" width="19" height="19"></canvas>
  </body>
</html>
